<!DOCTYPE html>
<html>

<head>
    <title>Admin – View Students | KIET</title>

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #f4f6f9;
        }

        /* ===== HEADER ===== */
        .header {
            display: flex;
            align-items: center;
            padding: 15px 40px;
            background: #1f3974;
            color: white;
        }

        .header img {
            height: 55px;
            margin-right: 18px;
        }

        /* ===== CONTAINER ===== */
        .container {
            padding: 30px 40px;
        }

        h2 {
            margin-top: 0;
        }

        /* ===== FILTER BOX ===== */
        .filter-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        select,
        button {
            padding: 7px;
            margin-right: 10px;
        }

        button {
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .reset-link {
            margin-left: 10px;
            color: #dc2626;
            text-decoration: none;
            font-weight: bold;
        }

        /* ===== TABLE ===== */
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }

        th {
            background: #e5e7eb;
        }

        .actions a {
            margin-left: 6px;
            font-weight: bold;
            text-decoration: none;
        }

        .delete {
            color: #dc2626;
        }

        .reset {
            color: #2563eb;
        }

        .back {
            display: inline-block;
            margin-top: 20px;
            font-weight: bold;
            text-decoration: none;
            color: #1e40af;
        }
    </style>
</head>

<body>

    <!-- ===== HEADER ===== -->
    <div class="header">
        <img src="/static/logo.png">
        <h2>KIET Group of Institutions – View Students</h2>
    </div>

    <div class="container">

        <h2>Students List</h2>

        <!-- ===== FILTER FORM ===== -->
        <div class="filter-box">
            <form method="get">

                <!-- YEAR -->
                <select name="year">
                    <option value="">-- Year --</option>
                    <option value="1" {% if fy=='1' %}selected{% endif %}>1</option>
                    <option value="2" {% if fy=='2' %}selected{% endif %}>2</option>
                    <option value="3" {% if fy=='3' %}selected{% endif %}>3</option>
                    <option value="4" {% if fy=='4' %}selected{% endif %}>4</option>
                </select>

                <!-- BRANCH -->
                <select name="branch" onchange="toggleSection(this.value)">
                    <option value="">-- Branch --</option>
                    <option value="csm" {% if fb=='csm' %}selected{% endif %}>CSM</option>
                    <option value="cai" {% if fb=='cai' %}selected{% endif %}>CAI</option>
                    <option value="csd" {% if fb=='csd' %}selected{% endif %}>CSD</option>
                    <option value="aid" {% if fb=='aid' %}selected{% endif %}>AID</option>
                    <option value="cyber" {% if fb=='cyber' %}selected{% endif %}>CYBER</option>
                    <option value="le" {% if fb=='le' %}selected{% endif %}>LE</option>
                </select>

                <!-- SECTION -->
                <select name="section" id="sectionSelect">
                    <option value="">-- Section --</option>
                    <option value="hostler" {% if fs=='hostler' %}selected{% endif %}>Hostel</option>
                    <option value="dayscholar" {% if fs=='dayscholar' %}selected{% endif %}>Day Scholar</option>
                </select>

                <button type="submit">Filter</button>
                <a class="reset-link" href="/admin/view_students">Reset</a>
            </form>
        </div>

        <!-- ===== STUDENTS TABLE ===== -->
        <table>
            <tr>
                <th>Roll</th>
                <th>Name</th>
                <th>Parent</th>
                <th>Year</th>
                <th>Branch</th>
                <th>Section</th>
                <th>Actions</th>
            </tr>

            {% for s in students %}
            <tr>
                <form method="post" action="/admin/update_student/{{ s.roll }}">
                    <td>{{ s.roll }}</td>
                    <td><input name="name" value="{{ s.name }}"></td>
                    <td><input name="parent" value="{{ s.parent }}"></td>
                    <td><input name="year" value="{{ s.year }}" size="3"></td>
                    <td><input name="branch" value="{{ s.branch }}" size="6"></td>
                    <td><input name="section" value="{{ s.section }}" size="8"></td>

                    <!-- ✅ ACTIONS -->
                    <td class="actions">
                        <button type="submit">Update</button>

                        <a class="delete" href="/admin/delete_student/{{ s.roll }}"
                            onclick="return confirm('Delete student?')">
                            Delete
                        </a>

                        |

                        <a class="reset" href="/admin/reset_student_password/{{ s.roll }}">
                            Reset Password
                        </a>
                    </td>
                </form>
            </tr>
            {% endfor %}
        </table>

        <a class="back" href="/admin/dashboard">⬅ Back to Dashboard</a>
    </div>

    <!-- ===== JS FOR LE SECTION ===== -->
    <script>
        function toggleSection(branch) {
            const section = document.getElementById("sectionSelect");
            if (branch === "le") {
                section.value = "";
                section.disabled = true;
            } else {
                section.disabled = false;
            }
        }
        toggleSection("{{ fb or '' }}");
    </script>

</body>

</html>